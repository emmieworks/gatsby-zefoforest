{"componentChunkName":"component---src-templates-post-js","path":"/wordpress-query/","result":{"data":{"markdownRemark":{"id":"ca8c4553-a986-5535-82b1-bca8f50211cf","excerpt":"WordPressで記事を表示するときいくつか書き方があります。 「それぞれの書き方はどう違うの？」 「そもそも、このプログラムは何をしているの？」 テンプレートを書いてて、分からなくなってきたので、WordPressの記事を表示する仕組みとコードの意味について整理してみました。 WordPress…","tableOfContents":"<ul>\n<li><a href=\"/wordpress-query/#wordpress%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%80%82-%E3%80%8C%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%AF%E3%81%A9%E3%81%86%E9%81%95%E3%81%86%E3%81%AE%EF%BC%9F%E3%80%8D-%E3%80%8C%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%80%81%E3%81%93%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AF%E4%BD%95%E3%82%92%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%EF%BC%9F%E3%80%8D-%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%A6%E3%80%81%E5%88%86%E3%81%8B%E3%82%89%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%9F%E3%81%AE%E3%81%A7%E3%80%81wordpress%E3%81%AE%E8%A8%98%E4%BA%8B%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%A8%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E6%84%8F%E5%91%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%95%B4%E7%90%86%E3%81%97%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%97%E3%81%9F%E3%80%82-wordpress%E3%81%AE%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%8B%E3%82%89%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E3%81%BE%E3%81%A7%E3%80%82\">WordPressで記事を表示するときいくつか書き方があります。 「それぞれの書き方はどう違うの？」 「そもそも、このプログラムは何をしているの？」 テンプレートを書いてて、分からなくなってきたので、WordPressの記事を表示する仕組みとコードの意味について整理してみました。 WordPressのサイトにアクセスしてからページが表示されるまで。</a></li>\n<li><a href=\"/wordpress-query/#%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%AF%E3%82%A8%E3%83%AA\">メインコンテンツを表示するメインクエリ</a></li>\n<li>\n<p><a href=\"/wordpress-query/#%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E8%A8%98%E4%BA%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B%E3%82%B5%E3%83%96%E3%82%AF%E3%82%A8%E3%83%AA\">さらなる記事データを表示するサブクエリ</a></p>\n<ul>\n<li><a href=\"/wordpress-query/#wp_query%E3%82%92%E4%BD%BF%E3%81%86\">WP_Queryを使う</a></li>\n<li><a href=\"/wordpress-query/#get_posts%E3%82%92%E4%BD%BF%E3%81%86\">get_postsを使う</a></li>\n<li><a href=\"/wordpress-query/#wp_query%E3%81%A8post%E3%81%AE%E9%81%95%E3%81%84\">WP_Queryとpostの違い</a></li>\n</ul>\n</li>\n<li><a href=\"/wordpress-query/#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>","html":"<h2 id=\"wordpressで記事を表示するときいくつか書き方があります。-「それぞれの書き方はどう違うの？」-「そもそも、このプログラムは何をしているの？」-テンプレートを書いてて、分からなくなってきたので、wordpressの記事を表示する仕組みとコードの意味について整理してみました。-wordpressのサイトにアクセスしてからページが表示されるまで。\" style=\"position:relative;\">WordPressで記事を表示するときいくつか書き方があります。 「それぞれの書き方はどう違うの？」 「そもそも、このプログラムは何をしているの？」 テンプレートを書いてて、分からなくなってきたので、WordPressの記事を表示する仕組みとコードの意味について整理してみました。 WordPressのサイトにアクセスしてからページが表示されるまで。</h2>\n<p>WordPressがページを表示するときの流れを図解します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdwoiQw//8QAFhABAQEAAAAAAAAAAAAAAAAAAQAg/9oACAEBAAEFAhZhx//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAABAgITH/2gAIAQEABj8Co1P/xAAbEAACAgMBAAAAAAAAAAAAAAABEQAhEDFxQf/aAAgBAQABPyGgqMZWCORDZ7z6ez//2gAMAwEAAgADAAAAEFPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAICAwEAAAAAAAAAAAAAAQARITEQQVGR/9oACAEBAAE/ELoBbwa+xPML7wc4tJZo85Zv/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"WordPressページが表示する仕組み\"\n        title=\"WordPressページが表示する仕組み\"\n        src=\"/static/cf5dc676cbf53c3671dbe3e8fdc7f220/4b190/ss-display-page.jpg\"\n        srcset=\"/static/cf5dc676cbf53c3671dbe3e8fdc7f220/e07e9/ss-display-page.jpg 200w,\n/static/cf5dc676cbf53c3671dbe3e8fdc7f220/066f9/ss-display-page.jpg 400w,\n/static/cf5dc676cbf53c3671dbe3e8fdc7f220/4b190/ss-display-page.jpg 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>① ユーザーがリンクをクリックすると、表示したいURLをWordPressに伝えます\n※この間に、WordPressのコアファイルがプラグインや、functions.phpなどを読み込ますが、詳細は割愛します。\n②データベースにアクセスし、表示したいページの記事データを取得します($wp_queryに保存されます)。\n③テーマフォルダから、ページに応じたテンプレートファイルを選びます。\n④テンプレートファイルと記事データを使って、ページを表示します</p>\n<p>ポイントは②WordPress側で記事データは自動で準備してくれるところ。</p>\n<p>テーマを作るときは、テンプレートファイルに、この記事データの内容を表示させるプログラムを書いていきます。</p>\n<h2 id=\"メインコンテンツを表示するメインクエリ\" style=\"position:relative;\">メインコンテンツを表示するメインクエリ</h2>\n<p>WordPressはアクセスしたURLに必要な記事データを自動でデータベースから取得してくれます。\nページに必要なコンテンツをデータベースに依頼することをメインクエリと呼んでいます。</p>\n<p>※クエリ（Query）とはデータベースへのお問い合わせのこと。メインクエリとは、「このページのメインコンテンツを取得してね」とWordPressからデータベースにお願いをしているんだとイメージしてください。</p>\n<p>WordPressのテンプレートファイルには、よくこんなコードが書かれていますね。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">have_posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// ①記事データが入って入れば処理を行う</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token function\">have_posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// ②各記事データについて処理を行う</span>\n        <span class=\"token function\">the_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ③次の記事データの情報を$postに入れる。</span>\n        <span class=\"token function\">the_title</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ④$postからtitle(記事タイトル)を表示</span>\n        <span class=\"token function\">the_content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ④$postからcontent(記事本文)を表示</span>\n    <span class=\"token keyword\">endwhile</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>記事が見つかりません。<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endif</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>このプログラムはメインクエリによって保存された記事データ($wp_query)から、各記事の情報を取り出して、タイトルや本文を表示させています。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAQACBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe47AmP/xAAWEAADAAAAAAAAAAAAAAAAAAARICH/2gAIAQEAAQUCFX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAEBAQEAAAAAAAAAAAAAAAABACEg/9oACAEBAAE/ITSTI4//2gAMAwEAAgADAAAAEFAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAEEAwAAAAAAAAAAAAAAAREAECExQXGh/9oACAEBAAE/EMkiTzLSTlXqljftnVv/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"メインループ図解\"\n        title=\"メインループ図解\"\n        src=\"/static/20d1a0c9215ae775c4d0a49c51011741/4b190/ss-main-query.jpg\"\n        srcset=\"/static/20d1a0c9215ae775c4d0a49c51011741/e07e9/ss-main-query.jpg 200w,\n/static/20d1a0c9215ae775c4d0a49c51011741/066f9/ss-main-query.jpg 400w,\n/static/20d1a0c9215ae775c4d0a49c51011741/4b190/ss-main-query.jpg 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>メインクエリをもとに、記事を表示させるループを<strong>メインループ</strong>と呼ばれます。 WordPressのコアファイル側がメインクエリを取得しておいてくれるため、テンプレートファイルにはメインクエリから記事データを表示するところだけ書けば良いわけです。</p>\n<h2 id=\"さらなる記事データを表示するサブクエリ\" style=\"position:relative;\">さらなる記事データを表示するサブクエリ</h2>\n<p>WordPressがはじめに取得してくれるメインクエリとは別のデータを使いたいときには、<strong>サブクエリ</strong>を使います。 例えば、関連記事（同じカテゴリーの記事）や同じ著者の他の記事を表示させたいときには、サブクエリの出番です。</p>\n<ul>\n<li><a href=\"/wordpress-related-posts/\">投稿に関連記事を表示する方法</a></li>\n</ul>\n<p>2ステップでコードを書きます。</p>\n<p>①サブクエリ（ほしい記事データの条件）を指定して、データベースから記事データを取得する</p>\n<p>②取得した記事データをページに表示する サブクエリを使って記事を表示させるときにはWP_Queryを使う方法と、get_postを使う方法の２種類があります。</p>\n<h3 id=\"wp_queryを使う\" style=\"position:relative;\">WP_Queryを使う</h3>\n<p>グローバル変数$wp_queryに記事データを格納するやりかたです。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">// ①サブクエリを指定して、データベースから記事データを取得する\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token variable\">$args</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token comment\">// 抽出条件を指定する</span>\n    <span class=\"token single-quoted-string string\">'post_per_page'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'5'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'post_type'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'post'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$query</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Query</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$args</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//②取得した記事データをページに表示する</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$query</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">have_posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$query</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">have_posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span>\n        <span class=\"token variable\">$query</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">the_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token double-quoted-string string\">\"&lt;?php the_permalink(); ?>\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">the_title</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endwhile</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wp_reset_postdata</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>記事が見つかりません。<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endif</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>①WP_Query()で使える抽出条件\n抽出条件いっぱいあるので、一部だけ抜粋しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token variable\">$args</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n    <span class=\"token single-quoted-string string\">'author'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 著者ID省く場合は-1,-2,-3</span>\n    <span class=\"token single-quoted-string string\">'category__in'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// カテゴリーID(複数)</span>\n    <span class=\"token single-quoted-string string\">'post__in'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 記事ID(複数)</span>\n    <span class=\"token single-quoted-string string\">'order'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'DESC'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// ソート順(ASC,DESC)</span>\n    <span class=\"token single-quoted-string string\">'orderby'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'date'</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>【WP_Queryで使える抽出条件についての詳しい記事】</p>\n<ul>\n<li><a href=\"https://liginc.co.jp/320285\" target=\"_blank\" rel=\"noopener noreferrer\">WP_Queryを使って、記事を自在に取得してくる方法 | 東京上野のWeb制作会社LIG</a></li>\n<li><a href=\"http://notebook.yamamotohiroyuki.com/wordpress/2012/08/15/%E3%81%A1%E3%82%87%E3%81%84%E3%81%A1%E3%82%87%E3%81%84%E5%BF%98%E3%82%8C%E3%82%8B%E3%80%8Ewp_query%E3%80%8F%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9/\" target=\"_blank\" rel=\"noopener noreferrer\">ちょいちょい忘れる『WP_Query』の使い方 | 予習と復習</a></li>\n<li><a href=\"http://notnil-creative.com/blog/archives/1288\" target=\"_blank\" rel=\"noopener noreferrer\">WP_Queryの使い方をPHPコードにまとめた便利なコード・スニペット</a></li>\n</ul>\n<p>②取得した記事データをページに表示する</p>\n<p>サブクエリを元に記事を表示するループをサブループと呼びます。\nメインループと同じようにhave<em>posts()やthe</em>post()を使います。</p>\n<p><code class=\"language-text\">wp_reset_postdata()</code>は、サブループで使っていた<code class=\"language-text\">$post</code>をメインループの値に戻してあげる処理です。</p>\n<p><code class=\"language-text\">$post</code>は、メインループとサブループで共有しているので、ここでリセット忘れると、その後のメインループ処理が続けられず、正しく表示できないらしい。</p>\n<h3 id=\"get_postsを使う\" style=\"position:relative;\">get_postsを使う</h3>\n<p>$posts（記事情報）の配列に記事データをいれるやり方です。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>p\n<span class=\"token comment\">// ①サブクエリを指定して、データベースから記事データを取得する</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token variable\">$args</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token comment\">// 抽出条件を指定する</span>\n    <span class=\"token single-quoted-string string\">'post_per_page'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'5'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'post_type'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'post'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$myposts</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_posts</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$args</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//②取得した記事データをページに表示する</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$myposts</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$myposts</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token function\">setup_postdata</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">the_permalink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">the_title</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endforeach</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wp_reset_postdata</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>記事が見つかりません。<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endif</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>①get_post()で使える抽出条件</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$args</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n    <span class=\"token single-quoted-string string\">'posts_per_page'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 取得件数（初期値：5）</span>\n    <span class=\"token single-quoted-string string\">'offset'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 最初に取得する記事（初期値：０）</span>\n    <span class=\"token single-quoted-string string\">'category'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// カテゴリーID</span>\n    <span class=\"token single-quoted-string string\">'category_name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// カテゴリー名称</span>\n    <span class=\"token single-quoted-string string\">'orderby'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'date'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 記事をソートする条件</span>\n    <span class=\"token single-quoted-string string\">'order'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'DESC'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 記事のソート順（ASC,DESC）</span>\n    <span class=\"token single-quoted-string string\">'include'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 含める記事ID</span>\n    <span class=\"token single-quoted-string string\">'exclude'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 除外する記事ID</span>\n    <span class=\"token single-quoted-string string\">'post_type'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'post'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 記事タイプ（post,page）</span>\n    <span class=\"token single-quoted-string string\">'author'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 著者のID</span>\n    <span class=\"token single-quoted-string string\">'author_name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 著者の名前</span>\n    <span class=\"token single-quoted-string string\">'post_status'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'publish'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 記事のステータス</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$posts_array</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_posts</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$args</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>【get_posts()で使える抽出条件についての詳しい記事】</p>\n<ul>\n<li><a href=\"https://elearn.jp/wpman/function/get_posts.html\" target=\"_blank\" rel=\"noopener noreferrer\">get_posts – WordPress私的マニュアル</a></li>\n<li><a href=\"https://memocarilog.info/wordpress/templatetug/3393\" target=\"_blank\" rel=\"noopener noreferrer\">get_posts()テンプレートタグを使った情報の取得と表示方法 ｜ memocarilog</a></li>\n<li><a href=\"http://wpdocs.osdn.jp/%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%BF%E3%82%B0/get_posts\" target=\"_blank\" rel=\"noopener noreferrer\">テンプレートタグ/get posts - WordPress Codex 日本語版</a></li>\n</ul>\n<p>②取得した記事データをページに表示する</p>\n<p><code class=\"language-text\">setup_postdata($post)</code>で記事データの配列から、<code class=\"language-text\">$post</code>に記事データを入れます。また、記事内容を表示するテンプレートタグ<code class=\"language-text\">the_title()</code>や<code class=\"language-text\">the_content()</code>が使えるようになります。</p>\n<h3 id=\"wp_queryとpostの違い\" style=\"position:relative;\">WP_Queryとpostの違い</h3>\n<p>WP_Queryとpostでは記事データを入れる変数（データを入れる箱）が違います。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 118.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAYABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHtU0gArAAf/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEhEEH/2gAIAQEAAQUCpUUSHnYI/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHBABAQACAgMAAAAAAAAAAAAAAQARITFBUWGB/9oACAEBAAE/IXP7dyw3I8S27h9rHkuLg7ti/9oADAMBAAIAAwAAABBjDzz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAaEAACAwEBAAAAAAAAAAAAAAABEQAhMVFB/9oACAEBAAE/ECFpRIQAjdFWfYQG28yICad7FDpeJiDAu5xQrKMccZF15pcJhF3P/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"wp_queryとpostsの違い\"\n        title=\"wp_queryとpostsの違い\"\n        src=\"/static/2f3ccb55404386f0f8635f72ccf5e82c/7cc5e/ss-wpquery-vs-posts.jpg\"\n        srcset=\"/static/2f3ccb55404386f0f8635f72ccf5e82c/e07e9/ss-wpquery-vs-posts.jpg 200w,\n/static/2f3ccb55404386f0f8635f72ccf5e82c/066f9/ss-wpquery-vs-posts.jpg 400w,\n/static/2f3ccb55404386f0f8635f72ccf5e82c/7cc5e/ss-wpquery-vs-posts.jpg 480w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>単なる記事の情報だけ使うときはget_post() 、記事の情報＋ページの条件分岐タグを使うときはWP_Queryと覚えておくといいと思います。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\">まとめ</h2>\n<ul>\n<li>URLに応じて、WordPressでは必要なページの記事データを自動取得してくれる</li>\n<li>メインクエリは、そのURLのメインコンテンツを表示するときに使う</li>\n<li>サブクエリはメインクエリに入っていないデータ（関連記事や著者の別記事など）を表示するときに使う</li>\n</ul>","frontmatter":{"title":"WordPressが記事を表示する仕組み〜メインクエリとサブクエリ〜","date":"2018/07/27","updateDate":null,"description":null,"category":"WordPress","tags":["WordPressテーマ自作"],"featured":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQBAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHieqebMD//xAAaEAACAgMAAAAAAAAAAAAAAAABAgQhABAR/9oACAEBAAEFApB4EtcFx9f/xAAVEQEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAwEBPwGn/8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQIBAT8Bh//EABkQAQACAwAAAAAAAAAAAAAAAAEQIQACEf/aAAgBAQAGPwKnmWxqs//EABsQAQACAgMAAAAAAAAAAAAAAAEAESFhEDFB/9oACAEBAAE/IVudaYqGx3HvEAQFD03HDRjj/9oADAMBAAIAAwAAABDwz//EABYRAAMAAAAAAAAAAAAAAAAAABARMf/aAAgBAwEBPxBUP//EABURAQEAAAAAAAAAAAAAAAAAABBR/9oACAECAQE/EIP/xAAZEAEBAQEBAQAAAAAAAAAAAAABESEAEDH/2gAIAQEAAT8QKAElC7vUmW11ej6U5ZbIg8JJBmGef//Z","aspectRatio":1.7699115044247788,"src":"/static/ec416c3898799adc781a10ffd547b97f/14b42/icatch-20180727.jpg","srcSet":"/static/ec416c3898799adc781a10ffd547b97f/f836f/icatch-20180727.jpg 200w,\n/static/ec416c3898799adc781a10ffd547b97f/2244e/icatch-20180727.jpg 400w,\n/static/ec416c3898799adc781a10ffd547b97f/14b42/icatch-20180727.jpg 800w","sizes":"(max-width: 800px) 100vw, 800px"},"original":{"height":450,"src":"/static/icatch-20180727-ec416c3898799adc781a10ffd547b97f.jpg","width":800}}}}}},"pageContext":{"slug":"/wordpress-query/","prev":{"fields":{"slug":"/wordpress-related-posts/"},"frontmatter":{"title":"WordPressテーマに関連記事を表示する"}},"next":{"fields":{"slug":"/wordpress-template/"},"frontmatter":{"title":"WordPressの仕組み〜テンプレートファイルの優先順位"}}}},"staticQueryHashes":["1941199855","3628787746","4032985131"]}