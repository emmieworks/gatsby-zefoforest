{"componentChunkName":"component---src-templates-post-js","path":"/python-image-download-pgm/","result":{"data":{"site":{"siteMetadata":{"title":"Zero Forest"}},"markdownRemark":{"id":"e2d267ff-60a4-59a1-b35a-38a93a4ea7c3","excerpt":"LivedoorブログからWordPressに移行するときに問題になるのが、画像のこと。 livedoor Blogには画像をエクスポートする機能がないため、スクレイピングツールなどで画像を抽出して保存する必要があります。 Mac用の画像取得ツールが見つからなかったので、Python…","tableOfContents":"<ul>\n<li><a href=\"/python-image-download-pgm/#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\">ソースコード</a></li>\n<li><a href=\"/python-image-download-pgm/#%E4%BD%BF%E3%81%84%E6%96%B9\">使い方</a></li>\n<li><a href=\"/python-image-download-pgm/#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E8%AA%AC%E6%98%8E\">プログラムの説明</a></li>\n</ul>","html":"<p>LivedoorブログからWordPressに移行するときに問題になるのが、画像のこと。</p>\n<p>livedoor Blogには画像をエクスポートする機能がないため、スクレイピングツールなどで画像を抽出して保存する必要があります。</p>\n<p>Mac用の画像取得ツールが見つからなかったので、Pythonで画像取得プログラムを書いてみました。</p>\n<h2 id=\"ソースコード\" style=\"position:relative;\">ソースコード</h2>\n<p>ブログの記事データから、画像のURLを取得してフォルダにダウンロードしています。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> re\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> urllib<span class=\"token punctuation\">.</span>request\n<span class=\"token keyword\">import</span> urllib<span class=\"token punctuation\">.</span>error\n\ncurrent_url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://livedoor.blogimg.jp/zeroforest\"</span> <span class=\"token comment\"># 現在のライブドアブログURL</span>\nimg_url <span class=\"token operator\">=</span> current_url<span class=\"token operator\">+</span><span class=\"token string\">'/*imgs/[\\w/:%#\\$&amp;\\?\\(\\)~\\.=\\+\\-]+'</span> <span class=\"token comment\"># 画像のURLURL</span>\n\nfile_name <span class=\"token operator\">=</span> <span class=\"token string\">\"backup.txt\"</span> <span class=\"token comment\"># 読み込むファイル名</span>\ndir_name <span class=\"token operator\">=</span> <span class=\"token string\">\"images\"</span> <span class=\"token comment\"># 画像保存先フォルダ名</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">download_file</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> dst_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> urllib<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>urlopen<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> web_file<span class=\"token punctuation\">:</span>\n      data <span class=\"token operator\">=</span> web_file<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>dst_path<span class=\"token punctuation\">,</span> mode<span class=\"token operator\">=</span><span class=\"token string\">'wb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> local_file<span class=\"token punctuation\">:</span>\n        local_file<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">except</span> urllib<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">.</span>URLError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n\nimages <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 画像URL格納</span>\n\n<span class=\"token comment\"># backup.txtから、画像URL取得</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>file_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> file_data<span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> file_data<span class=\"token punctuation\">:</span>\n    url_list <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>findall<span class=\"token punctuation\">(</span>img_url<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> url <span class=\"token keyword\">in</span> url_list<span class=\"token punctuation\">:</span>\n      images<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\"個の画像を取得します\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 画像保存先フォルダがなければ作成する。</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n  os<span class=\"token punctuation\">.</span>makedirs<span class=\"token punctuation\">(</span>dir_name<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">pass</span>\n\n<span class=\"token comment\"># 画像のダウンロード</span>\n<span class=\"token keyword\">for</span> img <span class=\"token keyword\">in</span> images<span class=\"token punctuation\">:</span>\n  download_file<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>dir_name<span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>basename<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"使い方\" style=\"position:relative;\">使い方</h2>\n<p>（pythonがインストールされている前提で説明します。）</p>\n<p>実際に使う場合には、<code class=\"language-text\">current_url</code>のところを自分のライブドアブログのURLを入れてください。</p>\n<p>コードのファイル名を「script.py」というファイル名で保存します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">フォルダ\n├─ script.py\n└─ backup.txt</code></pre></div>\n<p>script.pyと同じフォルダに管理画面からエクスポートした記事データ「backup.txt」を置きます。</p>\n<p>script.pyがあるフォルダでターミナルを開いてプログラムを実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ python script.py</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">フォルダ\n├─ script.py\n├─ backup.txt\n└─ images\n    ├─ 〇〇-s.jpg\n    ├─ 〇〇.jpg</code></pre></div>\n<p>imagesフォルダに画像が保存されています。</p>\n<h2 id=\"プログラムの説明\" style=\"position:relative;\">プログラムの説明</h2>\n<p>このプログラムでやっていること</p>\n<ol>\n<li>backup.txtから画像のURLを取得する</li>\n<li>imagesフォルダを作成する</li>\n<li>画像のURLにアクセスし、画像をimagesフォルダにダウンロードする。</li>\n</ol>","frontmatter":{"title":"【Python】Livedoorブログの画像を一括ダウンロードするプログラム","date":"2020/05/09","updateDate":null,"description":null,"category":"Programming","tags":["Python"],"featured":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHelqKEH//EABYQAQEBAAAAAAAAAAAAAAAAAAEQAP/aAAgBAQABBQLFCf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAEFAQAAAAAAAAAAAAAAAAEAEBEhQZH/2gAIAQEAAT8hxRBqW1C43//aAAwDAQACAAMAAAAQCO//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMUFRccH/2gAIAQEAAT8QcTx8goJebXZ6i5OkhFabwW3RKJ//2Q==","aspectRatio":1.7699115044247788,"src":"/static/fba5384906fc65d63759cea089d92a84/14b42/icatch-20200509.jpg","srcSet":"/static/fba5384906fc65d63759cea089d92a84/f836f/icatch-20200509.jpg 200w,\n/static/fba5384906fc65d63759cea089d92a84/2244e/icatch-20200509.jpg 400w,\n/static/fba5384906fc65d63759cea089d92a84/14b42/icatch-20200509.jpg 800w,\n/static/fba5384906fc65d63759cea089d92a84/a6352/icatch-20200509.jpg 960w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"/python-image-download-pgm/","prev":{"fields":{"slug":"/diary-202004/"},"frontmatter":{"title":"【活動記録】ゆったり家で過ごす4月"}},"next":{"fields":{"slug":"/move-livedoor-to-wordpress/"},"frontmatter":{"title":"LivedoorブログからWordPressへのお引っ越し手順"}}}},"staticQueryHashes":["1941199855","3628787746","4032985131"]}