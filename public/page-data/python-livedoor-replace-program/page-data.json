{"componentChunkName":"component---src-templates-post-js","path":"/python-livedoor-replace-program/","result":{"data":{"site":{"siteMetadata":{"title":"Zero Forest"}},"markdownRemark":{"id":"811b4453-d047-5c82-a57b-8abc345d164e","excerpt":"Livedoorブログの記事データをWordPressへと移行する際に、いくつか記事データの内容を書き換える必要があります。 ①画像のURL\n旧： https://livedoor.blogimg.jp/ライブドアID/imgs/●/●/\n新： https://独自ドメイン/wp-content/uploads…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/python-livedoor-replace-program/#%E6%96%87%E5%AD%97%E5%88%97%E7%BD%AE%E3%81%8D%E6%8F%9B%E3%81%88%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\">文字列置き換えプログラム</a></p>\n<ul>\n<li><a href=\"/python-livedoor-replace-program/#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E5%AE%9F%E8%A1%8C\">プログラムの実行</a></li>\n</ul>\n</li>\n</ul>","html":"<p> Livedoorブログの記事データをWordPressへと移行する際に、いくつか記事データの内容を書き換える必要があります。</p>\n<blockquote>\n<p>①画像のURL\n旧： <a href=\"https://livedoor.blogimg.jp/%E3%83%A9%E3%82%A4%E3%83%96%E3%83%89%E3%82%A2ID/imgs/%E2%97%8F/%E2%97%8F/\">https://livedoor.blogimg.jp/ライブドアID/imgs/●/●/</a>\n新： <a href=\"https://%E7%8B%AC%E8%87%AA%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3/wp-content/uploads/images/\">https://独自ドメイン/wp-content/uploads/images/</a></p>\n<p>②タグ（タグ未使用の場合は設定不要）\n旧：TAG\n新：TAGS</p>\n<p>③内部リンク\n旧：<a href=\"http://blog.livedoor.jp/%E3%83%A9%E3%82%A4%E3%83%96%E3%83%89%E3%82%A2ID/archives/\">http://blog.livedoor.jp/ライブドアID/archives/</a>\n新：<a href=\"https://%E7%8B%AC%E8%87%AA%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3/archives/\">https://独自ドメイン/archives/</a></p>\n<p>④記事を下書き状態に</p>\n<p>旧：STATUS: Publish\n新：STATUS: Draft</p>\n<p>&#x3C;/move-livedoor-to-wordpress/></p>\n</blockquote>\n<p>テキストエディタで変換してもいいのですが、ミスや手間を減らすために、Pythonでプログラムを書いてみました。</p>\n<h2 id=\"文字列置き換えプログラム\" style=\"position:relative;\">文字列置き換えプログラム</h2>\n<div class=\"gatsby-code-title\">replace.py</div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> re\n<span class=\"token keyword\">import</span> os\n\ncurrent_url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://livedoor.blogimg.jp/zeroforest\"</span> <span class=\"token comment\"># 現在のHPのURL</span>\nnew_url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://sample.local\"</span> <span class=\"token comment\"># 新しいHPのURL</span>\nimg_dir_path <span class=\"token operator\">=</span> <span class=\"token string\">\"/wp-content/uploads/images/\"</span> <span class=\"token comment\">#WordPressの画像アップロードファイル</span>\nimg_pattern <span class=\"token operator\">=</span> current_url<span class=\"token operator\">+</span><span class=\"token string\">r'/*imgs/[\\w/:%#\\$&amp;\\?\\(\\)~\\.=\\+\\-]+'</span>\n\noriginal_file_path <span class=\"token operator\">=</span> <span class=\"token string\">\"./backup.txt\"</span> <span class=\"token comment\"># ファイル名</span>\nnew_file_path <span class=\"token operator\">=</span><span class=\"token string\">\"./backup_updated.txt\"</span> <span class=\"token comment\">#更新後のファイル</span>\n\nnew_lines <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>original_file_path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> f<span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># TAGをTAGSに変換</span>\n      line <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">\"TAG: \"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"TAGS: \"</span><span class=\"token punctuation\">,</span>line<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\"># 画像URLをWordPressの画像アップロード先に変更</span>\n      img_url_list <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>findall<span class=\"token punctuation\">(</span>img_pattern<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">for</span> image_url <span class=\"token keyword\">in</span> img_url_list<span class=\"token punctuation\">:</span>\n        line <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span>image_url<span class=\"token punctuation\">,</span>new_url<span class=\"token operator\">+</span>img_dir_path<span class=\"token operator\">+</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>basename<span class=\"token punctuation\">(</span>image_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>line<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\"># 記事状態を下書きに変更</span>\n      line <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">\"STATUS: Publish\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"STATUS: Draft\"</span><span class=\"token punctuation\">,</span>line<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\"># 旧URLを親URLに変更</span>\n      line <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span>current_url<span class=\"token punctuation\">,</span>new_url<span class=\"token punctuation\">,</span>line<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\"># パーマリンクから.htmlを削除</span>\n      <span class=\"token comment\">#if(re.match(r'PATH: ', line)):</span>\n      <span class=\"token comment\">#  print(line)</span>\n      <span class=\"token comment\">#  line = re.sub(r'.html$','',line)</span>\n\n      new_lines <span class=\"token operator\">+=</span> line\n\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>new_file_path<span class=\"token punctuation\">,</span> mode<span class=\"token operator\">=</span><span class=\"token string\">'w'</span><span class=\"token punctuation\">,</span> encoding<span class=\"token operator\">=</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n  f<span class=\"token punctuation\">.</span>writelines<span class=\"token punctuation\">(</span>new_lines<span class=\"token punctuation\">)</span></code></pre></div>\n<p>このコードを「replace.py」というファイル名で保存します。</p>\n<h3 id=\"プログラムの実行\" style=\"position:relative;\">プログラムの実行</h3>\n<p>ライブドアブログbackup.txtとプログラムをreplace.pyを同じフォルダにおきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">フォルダ\n├─ replace.py\n└─ backup.txt</code></pre></div>\n<p>script.pyがあるフォルダでターミナルを開いてプログラムを実行すると、backup.txtが書き換わります。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> $ python replace.py</code></pre></div>","frontmatter":{"title":"【Python】Livedoorのバックアップデータ（backup.txt）をWordPress移行用に置き換える","date":"2020/05/30","updateDate":null,"description":null,"category":"Programming","tags":null,"featured":null}}},"pageContext":{"slug":"/python-livedoor-replace-program/","prev":{"fields":{"slug":"/python-gsc-db/"},"frontmatter":{"title":"【Python】Google Search Consoleの検索パフォーマンスをDBに保存するプログラム"}},"next":{"fields":{"slug":"/diary-202005/"},"frontmatter":{"title":"【活動記録】ストレングスファインダーで強みを探す5月"}}}},"staticQueryHashes":["1941199855","3628787746","4032985131"]}